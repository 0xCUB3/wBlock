# AdGuard Scriptlets in wBlock

wBlock vendors AdGuard’s scriptlet function bundle into the extension JS files. This is used to execute `#%#//scriptlet(...)` rules without touching wBlock-specific logic (userscripts, element zapper, blocked count, etc.).

## Where the bundle lives

- `wBlock Advanced/Resources/script.js`
- `wBlock Scripts (iOS)/Resources/background.js`
- `wBlock Scripts (iOS)/Resources/content.js`

## What to update

Only the “scriptlet function bundle” section should be replaced. In all three files it starts at:

- `function AmazonApstag(source, args) {`

and ends right before:

- `function passSourceAndProps(source, code) {`

Everything after that (including the `SafariExtension v...` block and wBlock’s own logic) should be left as-is.

## Source of truth

The bundled functions come from:

- https://github.com/AdguardTeam/Scriptlets (`@adguard/scriptlets`)

Build output used:

- `tmp/scriptlets-func.js` (generated by `npm run build` in that repo)

Notes:

- Remove the ESM line `export { getScriptletFunction };` before embedding.
- The bundle now includes a scriptlet named `log`, so wBlock’s own logger binding must not be named `log` (use `wBlockLogger`).

